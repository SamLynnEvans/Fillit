protect mallocs
check error messages
close file
